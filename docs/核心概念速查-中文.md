# 泰语学习应用 - 核心概念速查（中文版）

**用途**：快速理解项目关键技术和模式，无需阅读全部英文文档

**对应英文文档**：00-06号详细文档

---

## 📚 文档对照表

| 中文章节 | 对应英文文档 | 用途 |
|---------|------------|------|
| 1. 项目总览 | 00-Project-Knowledge-Base.md | 项目状态和架构 |
| 2. Expo Router核心 | 01-Expo-Router-Explained.md | 文件路由系统 |
| 3. 项目路由详解 | 02-Project-Routing-Navigation.md | 本项目路由实现 |
| 4. 文件导入关系 | 03-File-Import-Dependencies.md | 依赖关系图 |
| 5. 参数传递方式 | 04-Parameter-Passing-Guide.md | 数据流模式 |
| 6. Zustand状态管理 | 05-Zustand-State-Management.md | 全局状态 |
| 7. 前端设计思路 | 06-Frontend-Design-Philosophy.md | UI/UX设计 |

---

# 1. 项目总览

> **详细内容**：[00-Project-Knowledge-Base.md](./00-Project-Knowledge-Base.md)

## 项目基本信息

**类型**：React Native泰语学习移动应用
**进度**：MVP 30%完成
**技术栈**：
- React Native 0.76.9 + Expo 52
- Expo Router v4（文件路由）
- Zustand 5.0.8（状态管理）
- TypeScript（严格模式）
- i18next（中英文切换）

## 三层架构

```
用户界面层（React组件）
    ↓
状态管理层（Zustand: userStore, learningStore, languageStore）
    ↓
数据层（AsyncStorage持久化 + 未来的API服务）
```

## 路由架构

```
启动 → 根布局检查认证
    ├─ 未登录 → /(auth)/login
    └─ 已登录 → /(tabs)/index
```

## 已完成功能 ✅
- 认证流程（模拟登录）
- 受保护路由（认证守卫）
- 自定义标签栏（凸起中间按钮）
- 用户资料页（统计数据）
- 多语言UI（中/英）
- 复习系统UI（闪卡）
- 进度跟踪结构
- 泰国文化设计系统

## 进行中 🔄
- 后端API集成
- 课程内容管理
- 学习模块

## 未开始 ❌
- 音频/TTS
- 管理面板
- 分析仪表板
- 社交功能

---

# 2. Expo Router核心

> **详细内容**：[01-Expo-Router-Explained.md](./01-Expo-Router-Explained.md)

## 核心概念

**文件即路由**：`app/`文件夹中的文件自动成为路由

```
app/
├── index.tsx          → "/"
├── profile.tsx        → "/profile"
└── course/
    └── [id].tsx       → "/course/123"（动态）
```

## 路由组（括号）

**不影响URL路径**，仅用于组织

```
app/
├── (auth)/
│   └── login.tsx      → "/login"（不是"/auth/login"）
└── (tabs)/
    └── home.tsx       → "/home"
```

## Layout文件

**`_layout.tsx`** 包裹同级所有路由

```typescript
// app/_layout.tsx
export default function RootLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" />
      <Stack.Screen name="profile" />
    </Stack>
  );
}
```

## 导航方法

```typescript
import { useRouter } from 'expo-router';

const router = useRouter();
router.push('/profile');      // 前进
router.replace('/login');     // 替换（无法返回）
router.back();                // 返回
```

## 与React Navigation对比

| Expo Router | React Navigation |
|------------|------------------|
| 文件自动成为路由 | 手动配置每个路由 |
| 约5行代码 | 约30行代码 |
| 自动深度链接 | 需要配置 |
| TypeScript路由安全 | 需要额外类型 |

---

# 3. 项目路由详解

> **详细内容**：[02-Project-Routing-Navigation.md](./02-Project-Routing-Navigation.md)

## 路由结构

```
app/
├── _layout.tsx                # 根布局 + 认证守卫
├── (auth)/                    # 公开路由
│   ├── _layout.tsx           # 已认证时重定向
│   ├── login.tsx             # 登录页
│   └── register.tsx          # 注册页
├── (tabs)/                    # 受保护路由
│   ├── _layout.tsx           # 自定义标签栏
│   ├── index.tsx             # 首页
│   ├── courses.tsx           # 课程列表
│   └── profile.tsx           # 个人中心
└── review-modal.tsx           # 复习模态窗口
```

## 认证守卫逻辑

```typescript
// app/_layout.tsx
useEffect(() => {
  const inAuthGroup = segments[0] === '(auth)';

  if (!isAuthenticated && !inAuthGroup) {
    router.replace('/(auth)/login');  // 未登录→登录页
  } else if (isAuthenticated && inAuthGroup) {
    router.replace('/(tabs)');        // 已登录→应用
  }
}, [isAuthenticated, segments]);
```

## 用户旅程

**首次用户**：
```
启动 → 根布局检查 → 未认证 → 登录页
→ 输入凭证 → userStore.login()
→ isAuthenticated = true → 自动重定向到首页
```

**返回用户**：
```
启动 → AsyncStorage加载状态
→ isAuthenticated = true → 直接进入首页
```

## 标签栏设计

- 3个标签：学习、首页、我的
- 中间首页按钮凸起
- iOS使用BlurView毛玻璃效果
- 激活状态：深色图标+文本

---

# 4. 文件导入关系

> **详细内容**：[03-File-Import-Dependencies.md](./03-File-Import-Dependencies.md)

## 五层架构

```
Layer 1: 常量和类型（无依赖）
  ↓
Layer 2: 基础设施（i18n, stores）
  ↓
Layer 3: 组件
  ↓
Layer 4: 页面
  ↓
Layer 5: 布局（控制流）
```

## 路径别名 @/

**配置**：`tsconfig.json` + `babel.config.js`

**用法**：
```typescript
// 不要这样
import { Colors } from '../../../src/constants/colors';

// 应该这样
import { Colors } from '@/src/constants/colors';
```

## 导入规则

**✅ 允许**：下层导入上层
```typescript
// 组件导入常量 ✅
import { Colors } from '@/src/constants/colors';

// 页面导入组件 ✅
import { Button } from '@/src/components/common/Button';
```

**❌ 禁止**：上层导入下层（循环依赖）
```typescript
// 常量导入组件 ❌
import { Button } from '@/src/components/common/Button';
```

## 最常被导入的文件

1. `src/constants/colors.ts` - 几乎所有组件
2. `src/constants/typography.ts` - 几乎所有组件
3. `src/stores/userStore.ts` - 4个文件
4. `src/types/entities.ts` - 3个文件

## 导入最多的文件

1. `app/(tabs)/profile.tsx` - 3个stores + 多个组件
2. `app/(tabs)/index.tsx` - 2个组件 + 5个图标
3. `app/(auth)/login.tsx` - 1个store + 3个组件

---

# 5. 参数传递方式

> **详细内容**：[04-Parameter-Passing-Guide.md](./04-Parameter-Passing-Guide.md)

## 三种方式

### 方式1：Props（组件间）

```typescript
// 父组件
<FloatingBubbles
  reviews={reviews}
  onOpenReview={handleClick}
/>

// 子组件
interface Props {
  reviews: ReviewItem[];
  onOpenReview: () => void;
}

export const FloatingBubbles: React.FC<Props> = ({
  reviews,
  onOpenReview
}) => {
  return <Pressable onPress={onOpenReview}>...</Pressable>;
};
```

**用于**：组件UI配置

---

### 方式2：Zustand State（全局）

```typescript
// 任何组件
const { currentUser, login } = useUserStore();

// 状态更新
await login(email, password);

// 所有使用useUserStore的组件自动重新渲染
```

**用于**：全局应用状态（用户、进度、设置）

---

### 方式3：URL参数（导航）

```typescript
// 导航时传递
router.push('/course/123?section=vocab');

// 接收参数
const { id, section } = useLocalSearchParams();
// id = "123", section = "vocab"
```

**用于**：深度链接、搜索过滤

---

## 数据流示例

**登录流程**：
```
LoginScreen: 用户点击登录
    ↓
userStore.login(email, password)
    ↓
set({ isAuthenticated: true })
    ↓
AsyncStorage保存
    ↓
所有订阅者重新渲染
    ↓
根布局检测到 → router.replace('/(tabs)')
    ↓
首页显示用户信息
```

**语言切换**：
```
LanguageSwitcher: changeLanguage('en')
    ↓
languageStore: set({ currentLanguage: 'en' })
    ↓
i18n.changeLanguage('en')
    ↓
AsyncStorage保存
    ↓
所有useTranslation()组件重新渲染
    ↓
文本更新："登录" → "Login"
```

---

# 6. Zustand状态管理

> **详细内容**：[05-Zustand-State-Management.md](./05-Zustand-State-Management.md)

## 为什么用Zustand？

| 特性 | Zustand | Redux |
|------|---------|-------|
| 样板代码 | 5行 | 30行 |
| Bundle大小 | 1.2KB | 10+KB |
| 学习曲线 | 简单 | 陡峭 |
| Provider | 不需要 | 需要 |

## 基本模式

```typescript
// 创建store
export const useUserStore = create<UserState>()(
  persist(
    (set, get) => ({
      // 状态
      currentUser: null,
      isAuthenticated: false,

      // 动作
      login: async (email, password) => {
        const user = await authenticate(email, password);
        set({ currentUser: user, isAuthenticated: true });
      },

      logout: () => {
        set({ currentUser: null, isAuthenticated: false });
      },
    }),
    {
      name: 'user-storage',  // AsyncStorage键
      storage: createJSONStorage(() => AsyncStorage),
    }
  )
);
```

## 项目中的3个Store

### 1. userStore（用户认证）

```typescript
// 状态
currentUser: User | null
isAuthenticated: boolean
authToken: string | null

// 动作
login(email, password): Promise<boolean>
logout(): void
setUser(user, token): void
checkAuth(): boolean

// 用法
const { currentUser, login, logout } = useUserStore();
await login('test@example.com', 'password');
```

---

### 2. learningStore（学习进度）

```typescript
// 状态
currentCourse: Course | null
progress: LearningProgress | null
completedContent: string[]

// 动作
setCourse(course): void
updateProgress(contentType, score): void
getCompletionRate(): number
resetLearning(): void

// 用法
const { progress, updateProgress } = useLearningStore();
updateProgress('vocabulary', 10);
```

---

### 3. languageStore（UI语言）

```typescript
// 状态
currentLanguage: 'zh' | 'en'

// 动作
changeLanguage(lang): void  // 同时更新i18n

// 用法
const { currentLanguage, changeLanguage } = useLanguageStore();
changeLanguage('en');
```

---

## 持久化

**persist中间件**自动保存到AsyncStorage：

```typescript
persist(
  (set, get) => ({ /* store */ }),
  {
    name: 'user-storage',  // AsyncStorage键
    storage: createJSONStorage(() => AsyncStorage),
  }
)
```

**流程**：
1. `set()`调用 → 自动保存到AsyncStorage
2. 应用启动 → 从AsyncStorage加载
3. 应用关闭 → 数据保留

---

## 性能优化：选择性订阅

```typescript
// ❌ 差：任何状态改变都重新渲染
const userStore = useUserStore();

// ✅ 好：只在displayName改变时重新渲染
const displayName = useUserStore(state => state.currentUser?.displayName);

// ✅ 好：选择多个值
const { email, displayName } = useUserStore(state => ({
  email: state.currentUser?.email,
  displayName: state.currentUser?.displayName,
}));
```

---

# 7. 前端设计思路

> **详细内容**：[06-Frontend-Design-Philosophy.md](./06-Frontend-Design-Philosophy.md)

## 设计原则

### 1. 文化真实性
- 泰国大象图案（非卡通）
- 泰金色作为主强调色
- 支持泰文字体（Sarabun）
- 双语UI

### 2. 纸墨美学
**灵感**：传统学习材料、书法

```typescript
Colors = {
  paper: '#FAF9F6',    // 米白色背景（陈旧纸张）
  ink: '#1A1A1A',      // 深黑色文字
  sand: '#E5E2DB',     // 柔和边框
  taupe: '#8E8B82',    // 次要文字
  thaiGold: '#D4AF37', // 泰金强调色
}
```

### 3. 极简的复杂性
- 初看：简洁清晰
- 交互后：丰富信息
- 渐进式披露

### 4. 默认无障碍
- 最小字体14px
- 最小触摸目标44px
- 颜色对比WCAG AA
- 多语言从第一天

---

## 字体系统

```typescript
// 英文标题
playfairRegular: 'PlayfairDisplay_400Regular'

// 中文文本
notoSerifRegular: 'NotoSerifSC_400Regular'

// 泰文
sarabunRegular: 'Sarabun_400Regular'

// 尺寸
h1: 32, h2: 24, h3: 20
body: 16, caption: 14, small: 12
```

**规则**：
- 用大小创建层次（不需要加粗）
- 根据语言选择合适字体
- 标题：稍微紧缩（letterSpacing: -0.5）
- 标签：大写+宽间距（letterSpacing: 1.5）

---

## 布局模式

### 1. 安全区域优先
```typescript
<SafeAreaView edges={['top']}>
  {/* 内容避开刘海 */}
</SafeAreaView>
```

### 2. 一致间距（8的倍数）
```typescript
gap: 8           // 紧密
padding: 16      // 舒适
margin: 24       // 宽松
marginTop: 32    // 慷慨
```

### 3. 卡片设计
```typescript
{
  backgroundColor: 'rgba(255, 255, 255, 0.8)',
  borderRadius: 24,        // 柔和圆角
  padding: 24,
  borderWidth: 1,
  borderColor: Colors.sand,
  shadowOpacity: 0.05,     // 轻微阴影
}
```

---

## 组件设计

### ThaiPatternBackground
- **用途**：文化背景装饰
- **透明度**：0.1-0.15（非常微妙）
- **何时用**：认证页、首页
- **何时不用**：数据密集页面

### FloatingBubbles
- **设计**：3卡堆叠，显示深度
- **旋转**：±2°增加趣味性
- **缩放**：0.95, 0.9营造透视
- **交互**：点击导航到复习

### LanguageSwitcher
- **compact变体**：地球图标+语言代码（认证页）
- **full变体**：双按钮选择器（个人中心）

### 自定义标签栏
- 3个标签
- 中间按钮凸起24px
- iOS毛玻璃效果
- 激活：深色图标+文本

---

## 色彩语义

| 颜色 | 用途 | 示例 |
|------|------|------|
| Ink | 主要文本、深色卡片 | 标题、英雄卡片 |
| Paper | 背景、浅色卡片 | 屏幕背景 |
| Thai Gold | 强调、成就 | 徽章、激活状态 |
| Taupe | 次要文本、图标 | 说明文字、未激活标签 |
| Sand | 边框、分隔线 | 卡片轮廓 |
| White | 高亮、激活 | 标签栏、按钮 |

---

## 动画策略

### 当前：最小化
**原因**：先建立扎实的信息架构

**现有动画**：
- 导航过渡（Expo Router默认）
- 按压反馈（内置透明度）
- 模糊效果（静态BlurView）

### 未来机会
- FloatingBubbles：温和漂浮
- 成就解锁：五彩纸屑
- 进度条：填充动画
- 卡片翻转：复习模态窗口

**原则**：
- 有目的（增强理解，不分心）
- 微妙（200-300ms）
- 自然（ease-in-out）
- 高性能（用Reanimated）

---

## 页面布局标准模式

```typescript
export default function Screen() {
  return (
    <SafeAreaView edges={['top']} style={styles.safeArea}>
      <ThaiPatternBackground opacity={0.15} />

      <ScrollView
        contentContainerStyle={{ paddingBottom: 120 }}  // 为标签栏留空
        showsVerticalScrollIndicator={false}
      >
        {/* 内容 */}
      </ScrollView>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  safeArea: {
    flex: 1,
    backgroundColor: Colors.paper,
  },
});
```

---

## 响应式策略

### 当前：移动优先
所有设计针对手机（375-430px宽度）

### 未来：平板支持
```typescript
const { width } = Dimensions.get('window');
const isTablet = width >= 768;

const styles = StyleSheet.create({
  container: {
    maxWidth: isTablet ? 672 : '100%',  // 平板上限制宽度
    alignSelf: 'center',
  }
});
```

**断点**：
- 手机：< 768px
- 平板：768-1024px
- 大平板：> 1024px

---

## 设计决策日志

### 为什么用衬线字体？
**决策**：Playfair Display而非无衬线
**理由**：
- 唤起传统学习（教科书、手稿）
- 更优雅独特
- 更好的品牌识别

### 为什么用米白背景？
**决策**：Paper (#FAF9F6)而非纯白(#FFFFFF)
**理由**：
- 减少眼睛疲劳（柔和温暖）
- 匹配"纸墨"主题
- 更精致的外观

### 为什么凸起标签按钮？
**决策**：中间首页按钮凸起而非平面
**理由**：
- 强调主要动作（首页/仪表板）
- 创造视觉趣味
- 成功应用的常见模式

---

## 最佳实践

### ✅ 应该做
- 使用设计标记（Colors, Typography）
- 尊重安全区域
- 为交互提供视觉反馈
- 在多个屏幕尺寸测试
- 从一开始考虑无障碍
- 保持动画微妙和有目的

### ❌ 不应该做
- 硬编码颜色或间距值
- 过度使用绝对定位
- 忽略平台差异（iOS vs Android）
- 信息过载屏幕
- 为视觉效果牺牲性能
- 使用复杂渐变（难维护）

---

## 总结对照

| 主题 | 核心要点 | 详细文档 |
|------|---------|---------|
| **项目总览** | 30% MVP，三层架构，认证守卫 | 00 |
| **Expo Router** | 文件=路由，括号分组，Layout包裹 | 01 |
| **项目路由** | auth组（公开）、tabs组（保护）、模态窗口 | 02 |
| **文件导入** | 5层架构，@/别名，避免循环 | 03 |
| **参数传递** | Props（组件）、Zustand（全局）、URL（导航）| 04 |
| **Zustand** | 3个stores，persist中间件，选择性订阅 | 05 |
| **设计思路** | 纸墨美学，泰金色，8倍间距，文化真实 | 06 |

---

## 快速查找

**我想...**
- 理解路由 → 第2、3节
- 管理状态 → 第6节
- 传递数据 → 第5节
- 匹配设计 → 第7节
- 查找导入 → 第4节
- 了解全局 → 第1节

**需要详细信息？**
参考对应的英文文档（00-06号）获取完整内容、代码示例和深入解释。

---

**创建时间**：2025-11-23
**语言**：中文（对应英文详细文档）
**用途**：快速参考核心概念，无需阅读全部英文内容
