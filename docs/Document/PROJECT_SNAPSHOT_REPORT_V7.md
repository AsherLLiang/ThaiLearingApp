# ğŸ“‹ Thai Learning App - å·¥ç¨‹çº§é¡¹ç›®å¿«ç…§è¯´æ˜ä¹¦

**ç‰ˆæœ¬**: v1.0.7  
**ç”Ÿæˆæ—¥æœŸ**: 2025-12-06  
**é¡¹ç›®çŠ¶æ€**: æ´»è·ƒå¼€å‘ä¸­

v1.0.7 - Engineering Frozen Version
- æ¶æ„å†»ç»“
- è¡¨ç»“æ„å†»ç»“
- Action æ¸…å•å†»ç»“
- ä»…å…è®¸ Bug ä¿®å¤ï¼Œä¸å…è®¸æ–°å¢æ¨¡å—


---

## ğŸ“‘ ç›®å½•

1. [é¡¹ç›®çœŸå®ç»“æ„å¿«ç…§](#1-é¡¹ç›®çœŸå®ç»“æ„å¿«ç…§)
2. [äº‘å‡½æ•°å…¨é‡æ¸…å•](#2-äº‘å‡½æ•°å…¨é‡æ¸…å•)
3. [æ•°æ®åº“çœŸå®ç»“æ„å¿«ç…§](#3-æ•°æ®åº“çœŸå®ç»“æ„å¿«ç…§)
4. [å‰åç«¯çœŸå®é€šä¿¡å…³ç³»å›¾](#4-å‰åç«¯çœŸå®é€šä¿¡å…³ç³»å›¾)
5. [ç³»ç»Ÿçº§é£é™©æ¸…å•](#5-ç³»ç»Ÿçº§é£é™©æ¸…å•)
6. [é¡¹ç›®å”¯ä¸€äº‹å®æºè§„åˆ™](#6-é¡¹ç›®å”¯ä¸€äº‹å®æºè§„åˆ™ssot)
7. [é˜²å´©å·¥å…·](#7-é˜²å´©å·¥å…·)

---

## 1ï¸âƒ£ é¡¹ç›®çœŸå®ç»“æ„å¿«ç…§

### âœ… æ•´ä½“æŠ€æœ¯æ ˆ

| æŠ€æœ¯å±‚ | æŠ€æœ¯é€‰å‹ | çŠ¶æ€ |
|--------|---------|------|
| **å‰ç«¯æ¡†æ¶** | React Native + Expo (v52.0.38) | âœ… æ­£å¸¸ |
| **è·¯ç”±** | expo-router v4.0.20 | âœ… æ­£å¸¸ |
| **çŠ¶æ€ç®¡ç†** | Zustand v5.0.8 | âœ… æ­£å¸¸ |
| **åç«¯å½¢å¼** | CloudBase Serverless (wx-server-sdk) | âœ… æ­£å¸¸ |
| **æ•°æ®åº“ç±»å‹** | CloudBase NoSQL (ç±»MongoDB) | âœ… æ­£å¸¸ |
| **è®¤è¯æ–¹å¼** | JWT (jsonwebtoken + bcryptjs) | âœ… æ­£å¸¸ |
| **å›½é™…åŒ–** | i18next + react-i18next | âœ… æ­£å¸¸ |
| **HTTPå®¢æˆ·ç«¯** | axios v1.13.2 | âœ… æ­£å¸¸ |

### âœ… é¡¹ç›®ç›®å½•ç»“æ„

```
ThaiLearningApp/
â”œâ”€â”€ app/                    # Expo Router é¡µé¢ (16ä¸ªæ–‡ä»¶)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/         # React ç»„ä»¶ (14ä¸ª)
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶ (3ä¸ª)
â”‚   â”‚   â”œâ”€â”€ api.endpoints.ts    âœ… APIç«¯ç‚¹ç»Ÿä¸€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ backend.config.ts   âœ… åç«¯ç¯å¢ƒé…ç½®
â”‚   â”‚   â””â”€â”€ constants.ts        âœ… å‰ç«¯å¸¸é‡
â”‚   â”œâ”€â”€ stores/             # ZustandçŠ¶æ€ç®¡ç† (6ä¸ª)
â”‚   â”‚   â”œâ”€â”€ alphabetStore.ts
â”‚   â”‚   â”œâ”€â”€ vocabularyStore.ts
â”‚   â”‚   â”œâ”€â”€ learningStore.ts
â”‚   â”‚   â”œâ”€â”€ moduleAccessStore.ts
â”‚   â”‚   â”œâ”€â”€ userStore.ts
â”‚   â”‚   â””â”€â”€ languageStore.ts
â”‚   â”œâ”€â”€ i18n/               # å›½é™…åŒ– (ä¸­è‹±æ³°ä¸‰è¯­)
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•° (5ä¸ª)
â”‚   â””â”€â”€ entities/           # ç±»å‹å®šä¹‰ (12ä¸ª)
â”œâ”€â”€ cloudbase/
â”‚   â””â”€â”€ functions/          # äº‘å‡½æ•° (8ä¸ª)
â”‚       â”œâ”€â”€ shared/         âš ï¸ å…±äº«npmåŒ… (å·²è§„èŒƒåŒ–)
â”‚       â”œâ”€â”€ alphabet/
â”‚       â”œâ”€â”€ learn-vocab/
â”‚       â”œâ”€â”€ memory-engine/
â”‚       â”œâ”€â”€ user-login/
â”‚       â”œâ”€â”€ user-register/
â”‚       â”œâ”€â”€ user-reset-password/
â”‚       â””â”€â”€ user-update-profile/
â””â”€â”€ docs/                   # é¡¹ç›®æ–‡æ¡£ (22ä¸ª)
```

### âš ï¸ å…±äº«ä»£ç ç»“æ„ (Critical)

**å…±äº«åŒ…**: `@thai-app/shared`  
**è·¯å¾„**: `cloudbase/functions/shared/`

| æ¨¡å—æ–‡ä»¶ | ç”¨é€” | å¼•ç”¨æ¬¡æ•° | é£é™©ç­‰çº§ |
|---------|------|---------|---------|
| `memoryEngine.js` | ç»Ÿä¸€è®°å¿†å¼•æ“æ ¸å¿ƒé€»è¾‘ | 3ä¸ªäº‘å‡½æ•° | âŒ **é«˜å±** - æ ¸å¿ƒé€»è¾‘ |
| `sm2.js` | SM-2ç®—æ³•å®ç° | 1ä¸ªäº‘å‡½æ•° | âš ï¸ ä¸­ç­‰ |
| `database.js` | æ•°æ®åº“é›†åˆå¼•ç”¨ | 3ä¸ªäº‘å‡½æ•° | âš ï¸ ä¸­ç­‰ |
| `validators.js` | å‚æ•°éªŒè¯å·¥å…· | 2ä¸ªäº‘å‡½æ•° | âœ… ä½é£é™© |
| `response.js` | ç»Ÿä¸€å“åº”æ ¼å¼ | 8ä¸ªäº‘å‡½æ•° | âŒ **é«˜å±** - å…¨å±€ä¾èµ– |
| `constants.js` | å¸¸é‡å®šä¹‰ | 4ä¸ªäº‘å‡½æ•° | âš ï¸ ä¸­ç­‰ |

> âŒ **è­¦å‘Š**: `shared/` æ¨¡å—ä¿®æ”¹ä¼šå½±å“æ‰€æœ‰äº‘å‡½æ•°ï¼Œå¿…é¡»è°¨æ…æµ‹è¯•

---

## 2ï¸âƒ£ äº‘å‡½æ•°å…¨é‡æ¸…å•

### âœ… 1. **alphabet** (å­—æ¯å­¦ä¹ )

**å…¥å£æ–‡ä»¶**: `index.js`  
**ç”¨é€”**: å­—æ¯æµ‹è¯•ä¸é€šå…³ç®¡ç†  
**HTTPè§¦å‘å™¨**: âœ… å·²é…ç½®

#### æ”¯æŒ Actions:

| Action | ç”¨é€” | å‚æ•° | è¿”å› |
|--------|------|------|------|
| `getLetterTest` | è·å–å­—æ¯æµ‹è¯•é¢˜ | æ—  | `{ questions: [] }` |
| `submitLetterTest` | æäº¤å­—æ¯æµ‹è¯•ç­”æ¡ˆ | `userId`, `answers[]` | `{ passed: boolean, score: number }` |
| `passLetterTest` | ç›´æ¥é€šè¿‡æµ‹è¯•(è°ƒè¯•ç”¨) | `userId` | `{ success: boolean }` |

#### ä¾èµ–çš„é›†åˆ:
- âœ… `letter_test_bank` (è¯»å–)
- âœ… `user_progress` (æ›´æ–° `letterCompleted` å­—æ®µ)

#### Handleræ–‡ä»¶:
- `handlers/getLetterTest.js`
- `handlers/submitLetterTest.js`
- `handlers/passLetterTest.js`

---

### âœ… 2. **learn-vocab** (å•è¯å­¦ä¹  - ä¼ ç»ŸAPI)

**å…¥å£æ–‡ä»¶**: `index.js`  
**ç”¨é€”**: å•è¯å­¦ä¹ çš„7ä¸ªä¼ ç»ŸAPI (å·²éƒ¨åˆ†è¿ç§»è‡³memory-engine)  
**HTTPè§¦å‘å™¨**: âœ… å·²é…ç½®

#### æ”¯æŒ Actions:

| Action | ç”¨é€” | å‚æ•° | è¿”å› | çŠ¶æ€ |
|--------|------|------|------|------|
| `getTodayWords` | è·å–ä»Šæ—¥å•è¯ | `userId`, `limit`, `offset` | `{ words[], summary }` | âœ… æ­£å¸¸ |
| `updateMastery` | æ›´æ–°æŒæ¡åº¦ | `userId`, `vocabularyId`, `mastery` | `{ success }` | âœ… æ­£å¸¸ |
| `toggleSkipWord` | è·³è¿‡/å–æ¶ˆè·³è¿‡å•è¯ | `userId`, `vocabularyId` | `{ skipped }` | âœ… æ­£å¸¸ |
| `getVocabularyDetail` | è·å–å•è¯è¯¦æƒ… | `vocabularyId` | `{ vocabulary }` | âœ… æ­£å¸¸ |
| `getReviewStatistics` | è·å–å¤ä¹ ç»Ÿè®¡ | `userId` | `{ statistics }` | âœ… æ­£å¸¸ |
| `getVocabularyList` | è·å–å•è¯åˆ—è¡¨ | `level`, `limit` | `{ vocabularies[] }` | âœ… æ­£å¸¸ |
| `getSkippedWords` | è·å–å·²è·³è¿‡å•è¯ | `userId`, `limit` | `{ words[] }` | âœ… æ­£å¸¸ |
| ~~`getTodayMemories`~~ | (å·²è¿ç§») | - | - | **âŒ MOVED_PERMANENTLY** |
| ~~`submitMemoryResult`~~ | (å·²è¿ç§») | - | - | **âŒ MOVED_PERMANENTLY** |
| ~~`checkModuleAccess`~~ | (å·²è¿ç§») | - | - | **âŒ MOVED_PERMANENTLY** |
| ~~`getUserProgress`~~ | (å·²è¿ç§») | - | - | **âŒ MOVED_PERMANENTLY** |

#### ä¾èµ–çš„é›†åˆ:
- âœ… `users` (è¯»å–)
- âœ… `vocabulary` (è¯»å–)
- âœ… `user_vocabulary_progress` (è¯»å†™)
- âš ï¸ `vocabularies` (æ³¨æ„æ‹¼å†™ä¸ä¸€è‡´!)

> **âš ï¸ é£é™©**: å­˜åœ¨ `vocabulary` å’Œ `vocabularies` ä¸¤ä¸ªé›†åˆåæ··ç”¨é—®é¢˜!

---

### âœ… 3. **memory-engine** (ç»Ÿä¸€è®°å¿†å¼•æ“)

**å…¥å£æ–‡ä»¶**: `index.js`  
**ç”¨é€”**: å­—æ¯/å•è¯/å¥å­çš„ç»Ÿä¸€è®°å¿†ç®¡ç† (UMEæ¶æ„)  
**HTTPè§¦å‘å™¨**: âœ… å·²é…ç½®

#### æ”¯æŒ Actions:

| Action | ç”¨é€” | å‚æ•° | è¿”å› |
|--------|------|------|------|
| `getTodayMemories` | è·å–ä»Šæ—¥å­¦ä¹ å†…å®¹ | `userId`, `entityType`, `limit`, `includeNew` | `{ items[], summary }` |
| `submitMemoryResult` | æäº¤å­¦ä¹ ç»“æœ | `userId`, `results[]` | `{ updatedMemories[] }` |
| `checkModuleAccess` | æ£€æŸ¥æ¨¡å—è®¿é—®æƒé™ | `userId`, `moduleType` | `{ allowed, progress }` |
| `getUserProgress` | è·å–ç”¨æˆ·å­¦ä¹ è¿›åº¦ | `userId` | `{ progress }` |

#### ä¾èµ–çš„é›†åˆ:
- âœ… `memory_status` (æ ¸å¿ƒè®°å¿†çŠ¶æ€è¡¨ï¼Œè¯»å†™é¢‘ç¹)
- âœ… `user_progress` (ç”¨æˆ·è¿›åº¦ï¼Œæ›´æ–° `dailyLimit`)
- âœ… `letters` (å­—æ¯å®ä½“)
- âœ… `vocabulary` (å•è¯å®ä½“)
- âœ… `sentences` (å¥å­å®ä½“)

#### Handleræ–‡ä»¶:
- `handlers/getTodayMemories.js` âŒ **é«˜å¤æ‚åº¦**
- `handlers/submitMemoryResult.js`
- `handlers/checkModuleAccess.js`
- `handlers/getUserProgress.js`

---

### âœ… 4. **user-login** (ç”¨æˆ·ç™»å½•)

**å…¥å£æ–‡ä»¶**: `index.js`  
**ç”¨é€”**: JWTè®¤è¯ç™»å½•  

#### å‚æ•°:
- `email` (å¿…å¡«)
- `password` (å¿…å¡«)

#### è¿”å›:
```json
{
  "success": true,
  "data": {
    "user": { ... },
    "token": "jwt_token",
    "expiresIn": 604800
  }
}
```

#### ä¾èµ–çš„é›†åˆ:
- âœ… `users` (è¯»å– + æ›´æ–° `lastLogin`)

---

### âœ… 5. **user-register** (ç”¨æˆ·æ³¨å†Œ)

**å…¥å£æ–‡ä»¶**: `index.js`  
**ç”¨é€”**: ç”¨æˆ·æ³¨å†Œ + åˆå§‹åŒ–è¿›åº¦  

#### å‚æ•°:
- `email` (å¿…å¡«)
- `password` (å¿…å¡«)
- `displayName` (å¿…å¡«)
- `role` (å¯é€‰, é»˜è®¤ "LEARNER")

#### å…³é”®é€»è¾‘:
1. åˆ›å»º `users` è¡¨è®°å½•
2. **åŒæ—¶åˆ›å»º `user_progress` åˆå§‹è®°å½•** âŒ **Critical**

#### ä¾èµ–çš„é›†åˆ:
- âœ… `users` (åˆ›å»º)
- âœ… `user_progress` (åˆ›å»ºåˆå§‹è®°å½•)

> **âŒ é«˜å±é£é™©**: è‹¥ `user_progress` åˆ›å»ºå¤±è´¥ä½† `users` åˆ›å»ºæˆåŠŸï¼Œä¼šå¯¼è‡´ç”¨æˆ·æ— æ³•ä½¿ç”¨ç³»ç»Ÿ

---

### âœ… 6. **user-reset-password**

**å…¥å£æ–‡ä»¶**: `index.js`  
**ç”¨é€”**: é‡ç½®å¯†ç   

#### ä¾èµ–çš„é›†åˆ:
- âœ… `users` (æ›´æ–° `passwordHash`)

---

### âœ… 7. **user-update-profile**

**å…¥å£æ–‡ä»¶**: `index.js`  
**ç”¨é€”**: æ›´æ–°ç”¨æˆ·èµ„æ–™  

#### ä¾èµ–çš„é›†åˆ:
- âœ… `users` (æ›´æ–°)

---

### âœ… 8. **shared** (å…±äº«npmåŒ…)

**å…¥å£æ–‡ä»¶**: `index.js`  
**åŒ…å**: `@thai-app/shared`  
**ç”¨é€”**: æ‰€æœ‰äº‘å‡½æ•°å…±ç”¨çš„å·¥å…·åº“  

#### å¯¼å‡ºæ¨¡å—:
```javascript
module.exports = {
  memoryEngine,   // è®°å¿†å¼•æ“æ ¸å¿ƒé€»è¾‘
  sm2,            // SM-2ç®—æ³•
  database,       // æ•°æ®åº“é›†åˆ
  validators,     // å‚æ•°éªŒè¯
  response,       // å“åº”æ ¼å¼åŒ–
  constants       // å¸¸é‡å®šä¹‰
};
```

---

## 3ï¸âƒ£ æ•°æ®åº“çœŸå®ç»“æ„å¿«ç…§

### âœ… 3.1 `users` (ç”¨æˆ·è¡¨)

**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·è´¦å·ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | ç”¨é€” | çŠ¶æ€ | é£é™© |
|--------|------|------|------|------|
| `_id` | String | æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆ | âœ… æ ¸å¿ƒ | - |
| `userId` | String | ä¸šåŠ¡å±‚ç”¨æˆ·ID | âœ… æ ¸å¿ƒ | âŒ **å¿…é¡»å”¯ä¸€** |
| `email` | String | ç™»å½•é‚®ç®± | âœ… æ ¸å¿ƒ | âŒ **å¿…é¡»å”¯ä¸€** |
| `passwordHash` | String | bcryptå“ˆå¸Œå¯†ç  | âœ… æ ¸å¿ƒ | - |
| `displayName` | String | æ˜¾ç¤ºåç§° | âœ… æ ¸å¿ƒ | - |
| `role` | String | è§’è‰² (LEARNER/ADMIN) | âœ… æ­£å¸¸ | - |
| `registrationDate` | ISO String | æ³¨å†Œæ—¥æœŸ | âœ… æ­£å¸¸ | - |
| `lastLogin` | ISO String | æœ€åç™»å½•æ—¶é—´ | âœ… æ­£å¸¸ | - |
| `isActive` | Boolean | è´¦å·æ˜¯å¦æ¿€æ´» | âœ… æ­£å¸¸ | - |
| `preferences` | Object | ç”¨æˆ·åå¥½è®¾ç½® | âœ… æ­£å¸¸ | - |
| `preferences.language` | String | ç•Œé¢è¯­è¨€ | âœ… æ­£å¸¸ | - |
| `preferences.notificationsEnabled` | Boolean | é€šçŸ¥å¼€å…³ | âœ… æ­£å¸¸ | - |

**ç´¢å¼•éœ€æ±‚**:
- âœ… `userId` (å”¯ä¸€ç´¢å¼•)
- âœ… `email` (å”¯ä¸€ç´¢å¼•)

---

### âœ… 3.2 `user_progress` (ç”¨æˆ·å­¦ä¹ è¿›åº¦)

**ç”¨é€”**: è®°å½•ç”¨æˆ·æ•´ä½“å­¦ä¹ è¿›åº¦å’Œæ¨¡å—è§£é”çŠ¶æ€

| å­—æ®µå | ç±»å‹ | ç”¨é€” | çŠ¶æ€ | é£é™© |
|--------|------|------|------|------|
| `_id` | String | æ•°æ®åº“ID | âœ… æ ¸å¿ƒ | - |
| `userId` | String | ç”¨æˆ·ID | âœ… æ ¸å¿ƒ | âŒ **å¤–é”®ä¾èµ–** |
| `letterCompleted` | Boolean | å­—æ¯å­¦ä¹ æ˜¯å¦å®Œæˆ | âœ… æ ¸å¿ƒ | âŒ **è§£é”é€»è¾‘å…³é”®å­—æ®µ** |
| `debugSkipLetter` | Boolean | è°ƒè¯•ç”¨:è·³è¿‡å­—æ¯ | âš ï¸ è°ƒè¯• | - |
| `letterProgress` | Float | å­—æ¯å­¦ä¹ è¿›åº¦(0-1) | âœ… æ­£å¸¸ | - |
| `wordProgress` | Float | å•è¯å­¦ä¹ è¿›åº¦(0-1) | âœ… æ­£å¸¸ | - |
| `sentenceProgress` | Float | å¥å­å­¦ä¹ è¿›åº¦(0-1) | âœ… æ­£å¸¸ | - |
| `wordUnlocked` | Boolean | å•è¯æ¨¡å—æ˜¯å¦è§£é” | âš ï¸ å†å²é—ç•™ | âš ï¸ å®é™…æœªä½¿ç”¨ |
| `sentenceUnlocked` | Boolean | å¥å­æ¨¡å—æ˜¯å¦è§£é” | âš ï¸ å†å²é—ç•™ | âš ï¸ å®é™…æœªä½¿ç”¨ |
| `articleUnlocked` | Boolean | æ–‡ç« æ¨¡å—æ˜¯å¦è§£é” | âš ï¸ å†å²é—ç•™ | âš ï¸ å®é™…æœªä½¿ç”¨ |
| `currentStage` | String | å½“å‰é˜¶æ®µ(letter/word/...) | âš ï¸ å†å²é—ç•™ | âš ï¸ å®é™…æœªä½¿ç”¨ |
| `totalStudyDays` | Integer | æ€»å­¦ä¹ å¤©æ•° | âœ… æ­£å¸¸ | - |
| `streakDays` | Integer | è¿ç»­å­¦ä¹ å¤©æ•° | âœ… æ­£å¸¸ | - |
| `lastStudyDate` | ISO String | æœ€åå­¦ä¹ æ—¥æœŸ | âœ… æ­£å¸¸ | - |
| `dailyLimit` | Integer | æ¯æ—¥å­¦ä¹ æ•°é‡é™åˆ¶ | âœ… æ–°å¢ | - |
| `createdAt` | ISO String | åˆ›å»ºæ—¶é—´ | âœ… æ­£å¸¸ | - |
| `updatedAt` | ISO String | æ›´æ–°æ—¶é—´ | âœ… æ­£å¸¸ | - |

**ç´¢å¼•éœ€æ±‚**:
- âœ… `userId` (å”¯ä¸€ç´¢å¼•)

**âš ï¸ é£é™©ç‚¹**:
1. **å¿…é¡»åœ¨ç”¨æˆ·æ³¨å†Œæ—¶åˆ›å»º**: è‹¥ç¼ºå¤±ä¼šå¯¼è‡´ `checkModuleAccess` æŠ¥é”™
2. **å­—æ®µæ··ä¹±**: `wordUnlocked/sentenceUnlocked` ç­‰å­—æ®µå·²ä¸ä½¿ç”¨ï¼Œä½†ä»£ç ä»åœ¨åˆå§‹åŒ–
3. **å…³é”®ä¾èµ–**: `letterCompleted` å­—æ®µå†³å®šæ˜¯å¦è§£é”æ‰€æœ‰å…¶ä»–æ¨¡å—

---

### âœ… 3.3 `memory_status` (ç»Ÿä¸€è®°å¿†çŠ¶æ€è¡¨)

**ç”¨é€”**: UMEæ ¸å¿ƒè¡¨ï¼Œå­˜å‚¨ç”¨æˆ·å¯¹æ¯ä¸ªå­¦ä¹ å®ä½“çš„è®°å¿†çŠ¶æ€

| å­—æ®µå | ç±»å‹ | ç”¨é€” | çŠ¶æ€ | é£é™© |
|--------|------|------|------|------|
| `_id` | String | æ•°æ®åº“ID | âœ… æ ¸å¿ƒ | - |
| `userId` | String | ç”¨æˆ·ID | âœ… æ ¸å¿ƒ | âŒ **å¤–é”®** |
| `entityType` | String | å®ä½“ç±»å‹(letter/word/sentence) | âœ… æ ¸å¿ƒ | âŒ **å¿…é¡»å‡†ç¡®** |
| `entityId` | String | å®ä½“ID | âœ… æ ¸å¿ƒ | âŒ **å¿…é¡»å­˜åœ¨** |
| `masteryLevel` | Float | æŒæ¡åº¦(0.0-1.0) | âœ… æ ¸å¿ƒ | - |
| `reviewStage` | Integer | SM-2å¤ä¹ é˜¶æ®µ | âœ… æ ¸å¿ƒ | - |
| `easinessFactor` | Float | SM-2ç®€æ˜“å› å­ | âœ… æ ¸å¿ƒ | - |
| `intervalDays` | Integer | SM-2å¤ä¹ é—´éš”(å¤©) | âœ… æ ¸å¿ƒ | - |
| `lastReviewAt` | ISO String | ä¸Šæ¬¡å¤ä¹ æ—¶é—´ | âœ… æ ¸å¿ƒ | - |
| `nextReviewAt` | ISO String | ä¸‹æ¬¡å¤ä¹ æ—¶é—´ | âœ… æ ¸å¿ƒ | âŒ **æŸ¥è¯¢å…³é”®** |
| `correctCount` | Integer | æ­£ç¡®æ¬¡æ•° | âœ… æ­£å¸¸ | - |
| `wrongCount` | Integer | é”™è¯¯æ¬¡æ•° | âœ… æ­£å¸¸ | - |
| `streakCorrect` | Integer | è¿ç»­æ­£ç¡®æ¬¡æ•° | âœ… æ­£å¸¸ | - |
| `isLocked` | Boolean | æ˜¯å¦é”å®š(æœªè§£é”) | âœ… æ­£å¸¸ | - |
| `createdAt` | ISO String | åˆ›å»ºæ—¶é—´ | âœ… æ­£å¸¸ | - |
| `updatedAt` | ISO String | æ›´æ–°æ—¶é—´ | âœ… æ­£å¸¸ | - |

**ç´¢å¼•éœ€æ±‚** (Critical):
- âœ… `userId` + `entityType` + `entityId` (å¤åˆå”¯ä¸€ç´¢å¼•)
- âœ… `userId` + `entityType` + `nextReviewAt` (æŸ¥è¯¢ç´¢å¼•)
- âœ… `userId` + `entityType` + `isLocked` (æŸ¥è¯¢ç´¢å¼•)

**âš ï¸ é£é™©ç‚¹**:
1. **æ€§èƒ½å…³é”®**: æ­¤è¡¨æŸ¥è¯¢é¢‘ç¹ï¼Œç´¢å¼•ç¼ºå¤±ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜
2. **å­—æ®µç¼ºå¤±**: `updateMemoryAfterReview` æ›´æ–°æ—¶è‹¥å­—æ®µä¸º `undefined` ä¼šå¯¼è‡´é”™è¯¯
3. **é‡å¤æ’å…¥**: éœ€è¦å”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤è®°å½•

---

### âœ… 3.4 `user_vocabulary_progress` (å•è¯å­¦ä¹ è¿›åº¦ - ä¼ ç»Ÿè¡¨)

**ç”¨é€”**: ä¼ ç»Ÿå•è¯å­¦ä¹ è¿›åº¦è¡¨ (ä¸ `memory_status` åŠŸèƒ½é‡å )

| å­—æ®µå | ç±»å‹ | ç”¨é€” | çŠ¶æ€ | é£é™© |
|--------|------|------|------|------|
| `_id` | String | æ•°æ®åº“ID | âœ… æ ¸å¿ƒ | - |
| `userId` | String | ç”¨æˆ·ID | âœ… æ ¸å¿ƒ | âŒ **å¤–é”®** |
| `vocabularyId` | String | å•è¯ID | âœ… æ ¸å¿ƒ | âŒ **å¤–é”®** |
| `mastery` | String | æŒæ¡åº¦(é™Œç”Ÿ/æ¨¡ç³Š/è®°å¾—) | âœ… æ ¸å¿ƒ | - |
| `reviewCount` | Integer | å¤ä¹ æ¬¡æ•° | âœ… æ­£å¸¸ | - |
| `lastReviewed` | ISO String | æœ€åå¤ä¹ æ—¶é—´ | âœ… æ­£å¸¸ | - |
| `nextReviewDate` | ISO String | ä¸‹æ¬¡å¤ä¹ æ—¥æœŸ | âœ… æ ¸å¿ƒ | âŒ **æŸ¥è¯¢å…³é”®** |
| `intervalDays` | Integer | å¤ä¹ é—´éš”(å¤©) | âœ… æ­£å¸¸ | - |
| `skipped` | Boolean | æ˜¯å¦å·²è·³è¿‡ | âœ… æ­£å¸¸ | - |
| `easinessFactor` | Float | SM-2ç®€æ˜“å› å­ | âœ… æ­£å¸¸ | - |

**âš ï¸ æ¶æ„é—®é¢˜**:
- **åŠŸèƒ½é‡å **: ä¸ `memory_status` åŠŸèƒ½é‡å¤
- **è¿ç§»é£é™©**: è‹¥å®Œå…¨è¿ç§»è‡³UMEï¼Œéœ€è¦æ•°æ®è¿ç§»ç­–ç•¥

---

### âœ… 3.5 `vocabulary` (å•è¯å®ä½“è¡¨)

**ç”¨é€”**: å­˜å‚¨æ³°è¯­å•è¯æ•°æ®

| å­—æ®µå | ç±»å‹ | ç”¨é€” | çŠ¶æ€ |
|--------|------|------|------|
| `_id` | String | å•è¯ID | âœ… æ ¸å¿ƒ |
| `thaiWord` | String | æ³°è¯­å•è¯ | âœ… æ ¸å¿ƒ |
| `meaning` | String | ä¸­æ–‡å«ä¹‰ | âœ… æ ¸å¿ƒ |
| `pronunciation` | String | å‘éŸ³ | âœ… æ­£å¸¸ |
| `audioPath` | String | éŸ³é¢‘è·¯å¾„ | âœ… æ­£å¸¸ |
| `partOfSpeech` | String | è¯æ€§ | âœ… æ­£å¸¸ |
| `level` | String | éš¾åº¦ç­‰çº§ | âœ… æ­£å¸¸ |
| `lessonNumber` | Integer | è¯¾ç¨‹åºå· | âœ… æ ¸å¿ƒ |
| `source` | String | æ¥æºæ•™æ(Thai_1/Thai_2...) | âœ… æ­£å¸¸ |

**ç´¢å¼•éœ€æ±‚**:
- âœ… `lessonNumber` (æ’åºæŸ¥è¯¢)
- âœ… `level` (ç­›é€‰æŸ¥è¯¢)

**âš ï¸ æ³¨æ„**: å­˜åœ¨ `vocabularies` (å¤æ•°å½¢å¼) é›†åˆåæ··ç”¨é—®é¢˜

---

### âœ… 3.6 `letters` (å­—æ¯å®ä½“è¡¨)

**ç”¨é€”**: å­˜å‚¨æ³°è¯­å­—æ¯æ•°æ®

| å­—æ®µå | ç±»å‹ | ç”¨é€” | çŠ¶æ€ |
|--------|------|------|------|
| `_id` | String | å­—æ¯ID | âœ… æ ¸å¿ƒ |
| `letter` | String | å­—æ¯å­—ç¬¦ | âœ… æ ¸å¿ƒ |
| `pronunciation` | String | å‘éŸ³ | âœ… æ ¸å¿ƒ |
| `audioPath` | String | éŸ³é¢‘è·¯å¾„ | âœ… æ­£å¸¸ |
| `lessonNumber` | Integer | è¯¾ç¨‹åºå· | âœ… æ ¸å¿ƒ |
| `type` | String | ç±»å‹(consonant/vowel) | âœ… æ­£å¸¸ |

**ç´¢å¼•éœ€æ±‚**:
- âœ… `lessonNumber` (æ’åºæŸ¥è¯¢)

---

### âœ… 3.7 `sentences` (å¥å­å®ä½“è¡¨)

**ç”¨é€”**: å­˜å‚¨æ³°è¯­å¥å­æ•°æ®

| å­—æ®µå | ç±»å‹ | ç”¨é€” | çŠ¶æ€ |
|--------|------|------|------|
| `_id` | String | å¥å­ID | âœ… æ ¸å¿ƒ |
| `thaiSentence` | String | æ³°è¯­å¥å­ | âœ… æ ¸å¿ƒ |
| `meaning` | String | ä¸­æ–‡å«ä¹‰ | âœ… æ ¸å¿ƒ |
| `audioPath` | String | éŸ³é¢‘è·¯å¾„ | âœ… æ­£å¸¸ |
| `lessonNumber` | Integer | è¯¾ç¨‹åºå· | âœ… æ ¸å¿ƒ |

---

### âœ… 3.8 `letter_test_bank` (å­—æ¯æµ‹è¯•é¢˜åº“)

**ç”¨é€”**: å­˜å‚¨å›ºå®šçš„å­—motheræµ‹è¯•é¢˜

| å­—æ®µå | ç±»å‹ | ç”¨é€” | çŠ¶æ€ |
|--------|------|------|------|
| `_id` | String | é¢˜ç›®ID | âœ… æ ¸å¿ƒ |
| `questions` | Array | é¢˜ç›®æ•°ç»„ | âœ… æ ¸å¿ƒ |

**âš ï¸ ä½¿ç”¨æ–¹å¼**: `getLetterTest` ç›´æ¥è¿”å›æ•´ä¸ª `questions` æ•°ç»„

---

## 4ï¸âƒ£ å‰åç«¯çœŸå®é€šä¿¡å…³ç³»å›¾

### âœ… 4.1 å‰ç«¯ â†’ äº‘å‡½æ•°è°ƒç”¨æ¸…å•

#### ğŸ“± å­—æ¯å­¦ä¹ é¡µé¢ (`app/(tabs)/alphabet.tsx`)

| è°ƒç”¨äº‘å‡½æ•° | Action | ä¼ å‚ | è¿”å› | ç»‘å®šStore | é£é™© |
|-----------|--------|------|------|-----------|------|
| `alphabet` | `getLetterTest` | æ—  | `{ questions[] }` | `alphabetStore` | âœ… ä½ |
| `alphabet` | `submitLetterTest` | `userId`, `answers[]` | `{ passed, score }` | `alphabetStore` | âš ï¸ ä¸­ç­‰ |

**é£é™©**:
- è‹¥ `questions` å­—æ®µç¼ºå¤± â†’ é¡µé¢å´©æºƒ
- è‹¥ `passed` å­—æ®µç¼ºå¤± â†’ æ— æ³•åˆ¤æ–­é€šè¿‡çŠ¶æ€

---

#### ğŸ“± å•è¯å­¦ä¹ é¡µé¢ (`app/(tabs)/vocabulary.tsx`)

| è°ƒç”¨äº‘å‡½æ•° | Action | ä¼ å‚ | è¿”å› | ç»‘å®šStore | é£é™© |
|-----------|--------|------|------|-----------|------|
| `memory-engine` | `getTodayMemories` | `userId`, `entityType: 'word'`, `limit` | `{ items[], summary }` | `vocabularyStore`, `learningStore` | âŒ **é«˜** |
| `memory-engine` | `submitMemoryResult` | `userId`, `results[]` | `{ updatedMemories[] }` | `vocabularyStore` | âŒ **é«˜** |
| `learn-vocab` | `toggleSkipWord` | `userId`, `vocabularyId` | `{ skipped }` | `vocabularyStore` | âœ… ä½ |

**é«˜é£é™©åŸå› **:
1. **`getTodayMemories`**: å¤æ‚çš„ç©¿æ’é€»è¾‘ (3æ–°:1å¤ä¹ )ï¼Œè‹¥é€»è¾‘é”™è¯¯ä¼šå¯¼è‡´å­¦ä¹ æµç¨‹æ··ä¹±
2. **`submitMemoryResult`**: æ‰¹é‡æ›´æ–°ï¼Œè‹¥å•ä¸ªå¤±è´¥å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´

---

#### ğŸ“± é¦–é¡µ (`app/(tabs)/home.tsx`)

| è°ƒç”¨äº‘å‡½æ•° | Action | ä¼ å‚ | è¿”å› | ç»‘å®šStore |
|-----------|--------|------|------|-----------|
| `memory-engine` | `checkModuleAccess` | `userId`, `moduleType` | `{ allowed, progress }` | `moduleAccessStore` |
| `memory-engine` | `getUserProgress` | `userId` | `{ progress }` | `userStore` |

---

### âœ… 4.2 äº‘å‡½æ•° â†’ æ•°æ®åº“çœŸå®è¯»å†™è¡Œä¸º

#### **alphabet** äº‘å‡½æ•°

```
submitLetterTest:
  - è¯»å–: letter_test_bank (è·å–ç­”æ¡ˆ)
  - æ›´æ–°: user_progress.letterCompleted (å…³é”®!)
  
é£é™©:
  - è‹¥ user_progress æ— è¯¥å­—æ®µ â†’ æ›´æ–°ç›´æ¥æŠ¥é”™
  - è‹¥æ›´æ–°å¤±è´¥ä½†å·²åˆ¤å®šé€šè¿‡ â†’ ç”¨æˆ·çŠ¶æ€ä¸ä¸€è‡´
```

---

#### **memory-engine** äº‘å‡½æ•°

```
getTodayMemories:
  - è¯»å–: user_progress (è·å– dailyLimit)
  - æ›´æ–°: user_progress.dailyLimit (å¯é€‰)
  - è¯»å–: memory_status (ç­›é€‰ä»Šæ—¥å¤ä¹ )
  - è¯»å–: letters/vocabulary/sentences (è·å–å®ä½“)
  - åˆ›å»º: memory_status (è‹¥æ–°å­¦å®ä½“ä¸å­˜åœ¨è®°å½•)
  
submitMemoryResult:
  - è¯»å–: memory_status (è·å–å½“å‰çŠ¶æ€)
  - æ›´æ–°: memory_status (æ›´æ–°æ‰€æœ‰SM-2å­—æ®µ)
  
é£é™©:
  - memory_status è¡¨æ— ç´¢å¼• â†’ æŸ¥è¯¢æ€§èƒ½é—®é¢˜
  - æ‰¹é‡æ›´æ–°è‹¥éƒ¨åˆ†å¤±è´¥ â†’ æ•°æ®ä¸ä¸€è‡´
  - nextReviewAt è®¡ç®—é”™è¯¯ â†’ å¤ä¹ æ—¶é—´æ··ä¹±
```

---

#### **learn-vocab** äº‘å‡½æ•°

```
getTodayWords:
  - è¯»å–: users
  - è¯»å–: user_vocabulary_progress (è·å–æ‰€æœ‰è¿›åº¦)
  - è¯»å–: vocabulary (è·å–æ–°è¯ + å¤ä¹ è¯)
  
updateMastery:
  - æ›´æ–°: user_vocabulary_progress (å•æ¡è®°å½•)
  
é£é™©:
  - vocabulary vs vocabularies é›†åˆåæ··ç”¨
  - mastery å­—æ®µå€¼ä¸è§„èŒƒ â†’ é€»è¾‘é”™è¯¯
```

---

## 5ï¸âƒ£ ç³»ç»Ÿçº§é£é™©æ¸…å•

### âŒ 5.1 ç»“æ„æ€§é£é™©

| é£é™©é¡¹ | ä¸¥é‡ç¨‹åº¦ | æè¿° | å½±å“èŒƒå›´ |
|--------|---------|------|---------|
| **å…±äº«æ¨¡å—ä¿®æ”¹** | ğŸ”´ æé«˜ | `shared/` ä¸‹ä»»ä½•æ–‡ä»¶ä¿®æ”¹éƒ½ä¼šå½±å“8ä¸ªäº‘å‡½æ•° | å…¨ç³»ç»Ÿ |
| **æ•°æ®åº“é›†åˆåæ··ç”¨** | ğŸŸ¡ ä¸­ç­‰ | `vocabulary` vs `vocabularies` æ··ç”¨ | learn-vocab |
| **user_progress ç¼ºå¤±** | ğŸ”´ æé«˜ | ç”¨æˆ·æ³¨å†Œæ—¶è‹¥æœªåˆ›å»º `user_progress` â†’ ç³»ç»Ÿä¸å¯ç”¨ | å…¨ç³»ç»Ÿ |
| **memory_status æ— ç´¢å¼•** | ğŸŸ  é«˜ | æŸ¥è¯¢æ€§èƒ½é—®é¢˜ï¼Œç”¨æˆ·é‡å¢é•¿åç³»ç»Ÿå˜æ…¢ | memory-engine |

---

### âŒ 5.2 æ¶æ„æ€§é£é™©

| é£é™©é¡¹ | ä¸¥é‡ç¨‹åº¦ | æè¿° |
|--------|---------|------|
| **åŒè®°å¿†ç³»ç»Ÿå¹¶å­˜** | ğŸŸ¡ ä¸­ç­‰ | `memory_status` å’Œ `user_vocabulary_progress` åŠŸèƒ½é‡å  |
| **å†å²é—ç•™å­—æ®µ** | ğŸŸ¢ ä½ | `wordUnlocked`, `sentenceUnlocked` ç­‰å­—æ®µ å·²ä¸ä½¿ç”¨ä½†ä»åœ¨åˆå§‹åŒ– |
| **ç¯å¢ƒå˜é‡ä¾èµ–** | ğŸŸ  é«˜ | `FORCE_UNLOCK`, `JWT_SECRET` ç­‰å¿…é¡»åœ¨CloudBaseç¯å¢ƒé…ç½®ï¼Œå¦åˆ™åŠŸèƒ½å¼‚å¸¸ |

---

### âŒ 5.3 æ•°æ®ä¸€è‡´æ€§é£é™©

| é£é™©é¡¹ | ä¸¥é‡ç¨‹åº¦ | æè¿° | è§£å†³æ–¹æ¡ˆ |
|--------|---------|------|---------|
| **æ³¨å†Œæ—¶åŒè¡¨åˆ›å»º** | ğŸ”´ æé«˜ | `users` åˆ›å»ºæˆåŠŸä½† `user_progress` åˆ›å»ºå¤±è´¥ â†’ ç”¨æˆ·æ— æ³•ä½¿ç”¨ | ä½¿ç”¨äº‹åŠ¡æˆ–è¡¥å¿æœºåˆ¶ |
| **æ‰¹é‡æ›´æ–°éƒ¨åˆ†å¤±è´¥** | ğŸŸ  é«˜ | `submitMemoryResult` æ‰¹é‡æ›´æ–°æ—¶éƒ¨åˆ†æˆåŠŸ | æ·»åŠ äº‹åŠ¡æˆ–å›æ»šæœºåˆ¶ |
| **å­—æ®µundefinedå†™å…¥** | ğŸ”´ æé«˜ | `updateMemoryAfterReview` è‹¥SM-2è¿”å› `undefined` â†’ æ•°æ®åº“æ›´æ–°æŠ¥é”™ | æ·»åŠ å­—æ®µéªŒè¯ |

---

### âŒ 5.4 å›¢é˜Ÿåä½œé£é™©

| é£é™©é¡¹ | ä¸¥é‡ç¨‹åº¦ | æè¿° |
|--------|---------|------|
| **æ— å­—æ®µæ–‡æ¡£** | ğŸŸ  é«˜ | æ–°æˆå‘˜ä¸çŸ¥é“å“ªäº›å­—æ®µå·²åºŸå¼ƒ |
| **actionæœªåŒæ­¥** | ğŸ”´ æé«˜ | å‰ç«¯è°ƒç”¨å·²è¿ç§»çš„action â†’ `MOVED_PERMANENTLY` é”™è¯¯ |
| **APIç«¯ç‚¹é…ç½®é”™è¯¯** | ğŸŸ  é«˜ | `api.endpoints.ts` ä¸­éƒ¨åˆ†ç«¯ç‚¹ä»æŒ‡å‘æ—§äº‘å‡½æ•° |

---

### âŒ 5.5 AIå¹¶è¡Œä¿®æ”¹å†²çªé£é™©

| é£é™©é¡¹ | ä¸¥é‡ç¨‹åº¦ | æè¿° |
|--------|---------|------|
| **åŒæ—¶ä¿®æ”¹sharedæ¨¡å—** | ğŸ”´ æé«˜ | å¤šä¸ªAIåŒæ—¶ä¿®æ”¹ `shared/memoryEngine.js` â†’ é€»è¾‘æ··ä¹± |
| **å­—æ®µå"çŒœæµ‹"** | ğŸ”´ æé«˜ | AIæœªæŸ¥è¯¢å®é™…æ•°æ®åº“ç›´æ¥"çŒœ"å­—æ®µå â†’ è¿è¡Œæ—¶æŠ¥é”™ |
| **æœªæ‰«æç°æœ‰äº‘å‡½æ•°** | ğŸŸ  é«˜ | AIæ–°å†™äº‘å‡½æ•°ä¸ç°æœ‰å‡½æ•°é‡å¤åŠŸèƒ½ |

---

## 6ï¸âƒ£ é¡¹ç›®å”¯ä¸€äº‹å®æºè§„åˆ™(SSOT)

### ğŸ“œ 6.1 æ–°å¢å­—æ®µå¿…é¡»åŒæ­¥åˆ°

1. âœ… **æ•°æ®åº“å­—æ®µæ–‡æ¡£** (æ­¤æ–‡æ¡£ç¬¬3èŠ‚)
2. âœ… **äº‘å‡½æ•°HandleréªŒè¯é€»è¾‘** (ä½¿ç”¨ `validators.js`)
3. âœ… **å‰ç«¯TypeScriptç±»å‹å®šä¹‰** (`src/entities/*.ts`)
4. âœ… **äº‘å‡½æ•° `constants.js`** (è‹¥ä¸ºæšä¸¾å€¼)

---

### ğŸ“œ 6.2 ä»»ä½•äºº/AI **ä¸å¾—**

1. âŒ ç›´æ¥"çŒœå­—æ®µå" â†’ **å¿…é¡»å…ˆæŸ¥è¯¢æ•°æ®åº“**
2. âŒ ç›´æ¥"å‡è®¾actionå·²å­˜åœ¨" â†’ **å¿…é¡»å…ˆæŸ¥è¯¢äº‘å‡½æ•° `index.js`**
3. âŒ æœªæ‰«æç°æœ‰äº‘å‡½æ•°å°±æ–°å†™å‡½æ•° â†’ **å¿…é¡»å…ˆè¿è¡Œ** `find_by_name` **æŸ¥è¯¢**
4. âŒ ä¿®æ”¹ `shared/` æ¨¡å—è€Œä¸è¿è¡Œå…¨é‡æµ‹è¯• â†’ **å¿…é¡»æµ‹è¯•æ‰€æœ‰äº‘å‡½æ•°**

---

### ğŸ“œ 6.3 ä¿®æ”¹æµç¨‹(Mandatory)

```mermaid
graph TD
    A[æ¥åˆ°éœ€æ±‚] --> B{æ˜¯å¦æ¶‰åŠæ•°æ®åº“?}
    B -->|æ˜¯| C[1. æŸ¥è¯¢ç°æœ‰é›†åˆå’Œå­—æ®µ]
    B -->|å¦| D[2. æ‰«æç°æœ‰äº‘å‡½æ•°]
    C --> E[2. è®¾è®¡å­—æ®µSchema]
    D --> F[3. è®¾è®¡API]
    E --> G[3. åŒæ­¥æ›´æ–°constants.js]
    F --> G
    G --> H[4. ä¿®æ”¹äº‘å‡½æ•°Handler]
    H --> I[5. æ›´æ–°å‰ç«¯ç±»å‹å®šä¹‰]
    I --> J[6. è¿è¡Œè‡ªæ£€è„šæœ¬]
    J --> K{æµ‹è¯•é€šè¿‡?}
    K -->|å¦| H
    K -->|æ˜¯| L[7. éƒ¨ç½²]
```

---

## 7ï¸âƒ£ é˜²å´©å·¥å…·

### ğŸ“‹ 7.1 å­—æ®µå¯¹è´¦æ¸…å•æ¨¡æ¿

**æ–‡ä»¶å**: `FIELD_RECONCILIATION.md`

```markdown
# å­—æ®µå¯¹è´¦æ¸…å•

## ä¿®æ”¹ä¿¡æ¯
- **ä¿®æ”¹äºº**: ___________
- **ä¿®æ”¹æ—¥æœŸ**: ___________
- **å…³è”éœ€æ±‚**: ___________

## æ•°æ®åº“å­—æ®µä¿®æ”¹

### é›†åˆå: ___________

| å­—æ®µå | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | ç”¨é€” | å·²åŒæ­¥ä½ç½® |
|--------|------|------|--------|------|-----------|
| | | â˜æ˜¯ â˜å¦ | | | â˜æ•°æ®åº“ â˜äº‘å‡½æ•° â˜å‰ç«¯ â˜æ–‡æ¡£ |

## éªŒè¯æ¸…å•

- [ ] å·²æ›´æ–° `shared/constants.js`
- [ ] å·²æ›´æ–°äº‘å‡½æ•° `validators.js` éªŒè¯è§„åˆ™
- [ ] å·²æ›´æ–°å‰ç«¯ TypeScript ç±»å‹å®šä¹‰
- [ ] å·²æ›´æ–°æ­¤æ–‡æ¡£ (PROJECT_SNAPSHOT_REPORT.md)
- [ ] å·²æµ‹è¯•æ‰€æœ‰ç›¸å…³äº‘å‡½æ•°
- [ ] å·²æµ‹è¯•å‰ç«¯é¡µé¢

## å½±å“èŒƒå›´è¯„ä¼°

| äº‘å‡½æ•° | æ˜¯å¦å½±å“ | ä¿®æ”¹å†…å®¹ | æµ‹è¯•çŠ¶æ€ |
|--------|---------|---------|---------|
| alphabet | â˜æ˜¯ â˜å¦ | | â˜å·²æµ‹è¯• â˜æœªæµ‹è¯• |
| learn-vocab | â˜æ˜¯ â˜å¦ | | â˜å·²æµ‹è¯• â˜æœªæµ‹è¯• |
| memory-engine | â˜æ˜¯ â˜å¦ | | â˜å·²æµ‹è¯• â˜æœªæµ‹è¯• |

## å›æ»šè®¡åˆ’

è‹¥éƒ¨ç½²å¤±è´¥ï¼Œå›æ»šæ­¥éª¤:
1. ___________
2. ___________
```

---

### ğŸ“‹ 7.2 äº‘å‡½æ•°Actionå¯¹è´¦è¡¨

**æ–‡ä»¶å**: `CLOUD_FUNCTION_ACTION_MAP.md`

```markdown
# äº‘å‡½æ•°Actionå¯¹è´¦è¡¨

| äº‘å‡½æ•° | Action | å‚æ•° | è¿”å›å­—æ®µ | å‰ç«¯è°ƒç”¨ä½ç½® | çŠ¶æ€ |
|--------|--------|------|---------|-------------|------|
| alphabet | getLetterTest | æ—  | questions[] | alphabetStore.fetchTest() | âœ… æ­£å¸¸ |
| alphabet | submitLetterTest | userId, answers[] | passed, score | alphabetStore.submitTest() | âœ… æ­£å¸¸ |
| alphabet | passLetterTest | userId | success | alphabetStore.passTest() | âœ… æ­£å¸¸ |
| memory-engine | getTodayMemories | userId, entityType, limit | items[], summary | learningStore.fetchToday() | âœ… æ­£å¸¸ |
| memory-engine | submitMemoryResult | userId, results[] | updatedMemories[] | learningStore.submitResults() | âœ… æ­£å¸¸ |
| memory-engine | checkModuleAccess | userId, moduleType | allowed, progress | moduleAccessStore.check() | âœ… æ­£å¸¸ |
| memory-engine | getUserProgress | userId | progress | userStore.fetchProgress() | âœ… æ­£å¸¸ |
| learn-vocab | getTodayWords | userId, limit, offset | words[], summary | vocabularyStore.fetchWords() | âœ… æ­£å¸¸ |
| learn-vocab | updateMastery | userId, vocabularyId, mastery | success | vocabularyStore.updateMastery() | âœ… æ­£å¸¸ |
| learn-vocab | toggleSkipWord | userId, vocabularyId | skipped | vocabularyStore.toggleSkip() | âœ… æ­£å¸¸ |
| learn-vocab | getVocabularyDetail | vocabularyId | vocabulary | vocabularyStore.fetchDetail() | âœ… æ­£å¸¸ |
| learn-vocab | getVocabularyList | level, limit | vocabularies[] | vocabularyStore.fetchList() | âœ… æ­£å¸¸ |
| learn-vocab | getSkippedWords | userId, limit | words[] | vocabularyStore.fetchSkipped() | âœ… æ­£å¸¸ |
| learn-vocab | ~~getTodayMemories~~ | - | - | - | âŒ MOVED (â†’ memory-engine) |

## æ–°å¢Actionæµç¨‹

1. åœ¨æ­¤è¡¨æ ¼æ·»åŠ ä¸€è¡Œ
2. ä¿®æ”¹äº‘å‡½æ•° `index.js` æ·»åŠ è·¯ç”±
3. åˆ›å»ºå¯¹åº”çš„ `handlers/*.js` æ–‡ä»¶
4. æ›´æ–° `shared/constants.js` çš„ `SUPPORTED_ACTIONS`
5. æ›´æ–°å‰ç«¯ `api.endpoints.ts`
6. æ›´æ–°å‰ç«¯å¯¹åº”çš„ Store
7. å…¨é‡æµ‹è¯•
```

---

### ğŸ“‹ 7.3 å‰åç«¯è°ƒç”¨çº¦æŸæ¨¡æ¿

**æ–‡ä»¶å**: `API_CONTRACT_TEMPLATE.md`

```markdown
# APIè°ƒç”¨çº¦æŸ

## äº‘å‡½æ•°: ___________
## Action: ___________

### è¯·æ±‚æ ¼å¼

```json
{
  "action": "___________",
  "data": {
    "param1": "ç±»å‹: ___ | å¿…å¡«: â˜æ˜¯ â˜å¦ | è¯´æ˜: ___",
    "param2": "ç±»å‹: ___ | å¿…å¡«: â˜æ˜¯ â˜å¦ | è¯´æ˜: ___"
  }
}
```

### å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": {
    "field1": "ç±»å‹: ___ | è¯´æ˜: ___",
    "field2": "ç±»å‹: ___ | è¯´æ˜: ___"
  },
  "message": "æ“ä½œæˆåŠŸ"
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "data": null,
  "message": "é”™è¯¯æè¿°",
  "errorCode": "ERROR_CODE"
}
```

### é”™è¯¯ç æ¸…å•

| é”™è¯¯ç  | è¯´æ˜ | å‰ç«¯å¤„ç†æ–¹å¼ |
|--------|------|-------------|
| INVALID_PARAMS | å‚æ•°é”™è¯¯ | æç¤ºç”¨æˆ·å¹¶è®°å½•æ—¥å¿— |
| USER_NOT_FOUND | ç”¨æˆ·ä¸å­˜åœ¨ | è·³è½¬ç™»å½•é¡µ |
| MODULE_LOCKED | æ¨¡å—æœªè§£é” | æç¤ºå®Œæˆå‰ç½®ä»»åŠ¡ |

### ä¾èµ–çš„æ•°æ®åº“é›†åˆ

| é›†åˆå | æ“ä½œç±»å‹ | å…³é”®å­—æ®µ |
|--------|---------|---------|
| | â˜è¯»å– â˜å†™å…¥ â˜æ›´æ–° â˜åˆ é™¤ | |

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```typescript
// Store: ___________
// Method: ___________

const response = await callCloudFunction('/___________', {
  action: '___________',
  data: {
    param1: value1,
    param2: value2
  }
});

if (response.success) {
  // æˆåŠŸå¤„ç†
} else {
  // é”™è¯¯å¤„ç†
}
```

### æµ‹è¯•ç”¨ä¾‹

- [ ] æ­£å¸¸æƒ…å†µæµ‹è¯•
- [ ] å‚æ•°ç¼ºå¤±æµ‹è¯•
- [ ] å‚æ•°ç±»å‹é”™è¯¯æµ‹è¯•
- [ ] æ•°æ®åº“è®°å½•ä¸å­˜åœ¨æµ‹è¯•
- [ ] æƒé™ä¸è¶³æµ‹è¯•
```

---

## ğŸ“Š é™„å½•: å¿«é€Ÿå‚è€ƒ

### A. ç¯å¢ƒå˜é‡æ¸…å•

| å˜é‡å | ç”¨é€” | å¿…å¡« | é»˜è®¤å€¼ |
|--------|------|------|--------|
| `JWT_SECRET` | JWTç­¾åå¯†é’¥ | âœ… æ˜¯ | - |
| `FORCE_UNLOCK` | è°ƒè¯•ç”¨:è·³è¿‡æ‰€æœ‰å­¦ä¹ é” | âŒ å¦ | - |

### B. npmåŒ…ä¾èµ–æ¸…å•

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `wx-server-sdk` | latest | CloudBase SDK |
| `bcryptjs` | latest | å¯†ç åŠ å¯† |
| `jsonwebtoken` | latest | JWTè®¤è¯ |

### C. å…³é”®æ–‡ä»¶è·¯å¾„é€ŸæŸ¥

| æ–‡ä»¶ | è·¯å¾„ |
|------|------|
| APIç«¯ç‚¹é…ç½® | `src/config/api.endpoints.ts` |
| å…±äº«å¸¸é‡ | `cloudbase/functions/shared/constants.js` |
| å…±äº«å“åº”æ ¼å¼ | `cloudbase/functions/shared/response.js` |
| ç»Ÿä¸€è®°å¿†å¼•æ“ | `cloudbase/functions/shared/memoryEngine.js` |
| SM-2ç®—æ³• | `cloudbase/functions/shared/sm2.js` |

---

## ğŸ¯ æ€»ç»“

### âœ… é¡¹ç›®å¥åº·åº¦è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **ä»£ç è§„èŒƒ** | ğŸŸ¢ 85/100 | å…±äº«æ¨¡å—å·²è§„èŒƒåŒ–ï¼Œç»“æ„æ¸…æ™° |
| **æ•°æ®åº“è®¾è®¡** | ğŸŸ¡ 70/100 | å­˜åœ¨é›†åˆåæ··ç”¨å’ŒåŒè®°å¿†ç³»ç»Ÿé—®é¢˜ |
| **é£é™©æ§åˆ¶** | ğŸŸ  60/100 | ç¼ºå°‘ç´¢å¼•ã€äº‹åŠ¡æœºåˆ¶å’Œå­—æ®µéªŒè¯ |
| **æ–‡æ¡£å®Œæ•´æ€§** | ğŸŸ¢ 80/100 | æœ¬æŠ¥å‘Šè¡¥å……ååŸºæœ¬å®Œæ•´ |
| **åä½œè§„èŒƒ** | ğŸŸ¡ 65/100 | ç¼ºå°‘å¼ºåˆ¶æ€§çš„ä¿®æ”¹æµç¨‹å’Œå¯¹è´¦æœºåˆ¶ |

### âš ï¸ ç´§æ€¥å¾…åŠäº‹é¡¹

1. **ğŸ”´ æé«˜ä¼˜å…ˆçº§**
   - [ ] ä¸º `memory_status` è¡¨æ·»åŠ å¤åˆç´¢å¼•
   - [ ] ä¿®å¤ `vocabulary` vs `vocabularies` é›†åˆåæ··ç”¨
   - [ ] ä¸ºç”¨æˆ·æ³¨å†Œæ·»åŠ äº‹åŠ¡ä¿æŠ¤

2. **ğŸŸ  é«˜ä¼˜å…ˆçº§**
   - [ ] æ¸…ç† `user_progress` è¡¨çš„å†å²é—ç•™å­—æ®µ
   - [ ] ä¸º `updateMemoryAfterReview` æ·»åŠ å­—æ®µéªŒè¯
   - [ ] æ›´æ–°å‰ç«¯ `api.endpoints.ts` ä¸­å·²è¿ç§»çš„ç«¯ç‚¹

3. **ğŸŸ¡ ä¸­ä¼˜å…ˆçº§**
   - [ ] è¯„ä¼°æ˜¯å¦éœ€è¦å®Œå…¨è¿ç§»åˆ°UMEæ¶æ„
   - [ ] å»ºç«‹CI/CDè‡ªåŠ¨æµ‹è¯•æµç¨‹

---

**æ–‡æ¡£ç»´æŠ¤**: æ­¤æ–‡æ¡£åº”åœ¨æ¯æ¬¡é‡å¤§ä¿®æ”¹åæ›´æ–°ï¼Œä¿è¯ä¸ºé¡¹ç›®å”¯ä¸€äº‹å®æºã€‚

**æœ€åæ›´æ–°**: 2025-12-06
